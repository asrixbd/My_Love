<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Moment | AsrixBD</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@1,300;1,600&family=Outfit:wght@100;300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <style>
        :root {
            --bg: #030303;
            --primary: #ff4d6d;
            --primary-glow: rgba(255, 77, 109, 0.4);
            --glass: rgba(15, 15, 15, 0.8);
            --border: rgba(255, 255, 255, 0.08);
            --text-main: #e0e0e0;
            --text-dim: #999;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body, html { height: 100%; overflow: hidden; background: var(--bg); color: var(--text-main); font-family: 'Outfit', sans-serif; }

        #canvas-container { position: fixed; inset: 0; z-index: 0; }

        /* --- Intro --- */
        #intro {
            position: fixed; inset: 0; background: var(--bg); z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .unlock-btn {
            padding: 1rem 3rem; background: transparent; border: 1px solid var(--border);
            color: white; letter-spacing: 2px; cursor: pointer; transition: 0.4s;
        }
        .unlock-btn:hover { border-color: var(--primary); box-shadow: 0 0 20px var(--primary-glow); }

        /* --- Story Layout --- */
        #story-container { height: 100vh; position: relative; z-index: 10; display: grid; place-items: center; perspective: 2000px; }

        .glass-card {
            background: var(--glass); backdrop-filter: blur(30px);
            border: 1px solid var(--border); padding: 3rem; width: 90%; max-width: 550px;
            position: absolute; opacity: 0; visibility: hidden; border-radius: 12px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .glass-card.active { visibility: visible; }

        h2 { font-family: 'Cormorant Garamond', serif; font-size: 2.5rem; font-weight: 300; margin-bottom: 1.2rem; }
        p { font-size: 1.1rem; color: var(--text-dim); line-height: 1.6; }
        .highlight { color: var(--primary); font-style: italic; }

        /* --- Advanced Tree Wrapper --- */
        .final-wrapper { display: flex; align-items: center; justify-content: center; min-height: 400px; position: relative; width: 100%; }
        #tree-box { width: 100%; max-width: 350px; z-index: 2; transform-origin: center; }
        #final-messages { 
            position: absolute; left: 58%; width: 45%; text-align: left; 
            opacity: 0; pointer-events: none; 
        }
        .msg-line { margin-bottom: 1.2rem; opacity: 0; transform: translateX(30px); font-size: 1.15rem; }

        /* --- UI Navigation --- */
        .nav-ui {
            position: absolute; bottom: 8%; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center; gap: 15px; z-index: 50;
        }
        .next-trigger {
            background: none; border: 1px solid var(--border); width: 55px; height: 55px;
            border-radius: 50%; cursor: pointer; color: var(--primary); transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .next-trigger:hover { background: var(--primary); color: white; }
        .progress-bar { width: 100px; height: 2px; background: rgba(255,255,255,0.1); position: relative; }
        #p-fill { position: absolute; left: 0; height: 100%; width: 25%; background: var(--primary); transition: 0.6s; }

        .cake { font-size: 4rem; cursor: pointer; margin: 1rem 0; display: inline-block; }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div id="intro">
        <div style="font-size: 0.8rem; letter-spacing: 4px; color: var(--text-dim); margin-bottom: 2rem;">Asrix BD Presents</div>
        <button class="unlock-btn" onclick="startStory()">OPEN ðŸ˜Š</button>
    </div>

    <main id="story-container">
        <div class="glass-card active" data-index="0">
            <h2>Hello, <span class="highlight">Oshu</span></h2>
            <p>I wanted to create something as unique and beautiful as you are. Today is your special day.</p>
        </div>

        <div class="glass-card" data-index="1">
            <h2>Your <span class="highlight">Presence</span></h2>
            <p>Distance means so little when someone means so much. Talking to you brings me a peace I can't explain.</p>
        </div>

        <div class="glass-card" data-index="2">
            <h2>A Little Wish</h2>
            <div class="cake" onclick="makeWish(this)">ðŸŽ‚</div>
            <p id="wish-note">Tap the cake to make a wish...</p>
            <h2 style="margin-top: 20px; font-size: 1.8rem;">Happy Birthday</h2>
        </div>

        <div class="glass-card" data-index="3" style="max-width: 800px;">
            <div class="final-wrapper">
                <div id="tree-box">
                    <svg viewBox="0 0 200 200" id="tree-svg">
                        <g id="tree-structure" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round">
                            <path id="main-trunk" d="M130,190 Q120,150 110,120 Q100,80 110,40" />
                            <path class="branch" d="M115,110 Q80,100 50,110" />
                            <path class="branch" d="M110,80 Q130,60 150,70" />
                            <path class="branch" d="M108,60 Q90,40 100,20" />
                            <line id="swing-rope-1" x1="65" y1="108" x2="65" y2="160" stroke-width="1" />
                            <line id="swing-rope-2" x1="90" y1="105" x2="90" y2="157" stroke-width="1" />
                            <rect id="swing-seat" x="60" y="157" width="35" height="3" rx="1" fill="white" stroke="none" />
                        </g>
                        <g id="heart-leaves"></g>
                    </svg>
                </div>
                <div id="final-messages">
                    <p class="msg-line">A promise made is a bond kept.</p>
                    <p class="msg-line">I will always be the person who stays, who listens, and who loves.</p>
                    <h2 class="msg-line highlight" style="margin-top: 1rem; font-size: 2rem;">I Love You.</h2>
                </div>
            </div>
        </div>

        <div class="nav-ui" id="ui" style="display: none;">
            <button class="next-trigger" id="nextBtn" onclick="nextStep()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </button>
            <div class="progress-bar"><div id="p-fill"></div></div>
        </div>
    </main>

    <script>
        let scene, camera, renderer, particles;
        let currentIdx = 0;
        const cards = document.querySelectorAll('.glass-card');

        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            const geo = new THREE.BufferGeometry();
            const pos = [];
            for(let i=0; i<800; i++) pos.push((Math.random()-0.5)*200, (Math.random()-0.5)*200, (Math.random()-0.5)*200);
            geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
            particles = new THREE.Points(geo, new THREE.PointsMaterial({ size: 0.4, color: 0xff4d6d, transparent: true, opacity: 0.4 }));
            scene.add(particles);
            camera.position.z = 70;
            
            function anim() { requestAnimationFrame(anim); particles.rotation.y += 0.0008; renderer.render(scene, camera); }
            anim();
        }

        function startStory() {
            gsap.to("#intro", { opacity: 0, scale: 0.9, duration: 1, onComplete: () => {
                document.getElementById('intro').style.display = 'none';
                document.getElementById('ui').style.display = 'flex';
                showCard(0);
            }});
        }

        function showCard(i) {
            const c = cards[i];
            gsap.fromTo(c, { opacity: 0, y: 50, visibility: 'visible' }, { opacity: 1, y: 0, duration: 1.2, ease: "power4.out" });
        }

        function nextStep() {
            if (currentIdx < cards.length - 1) {
                gsap.to(cards[currentIdx], { opacity: 0, y: -50, duration: 0.6, onComplete: () => {
                    cards[currentIdx].classList.remove('active');
                    currentIdx++;
                    cards[currentIdx].classList.add('active');
                    
                    if(currentIdx === 3) {
                        initHearts();
                        showCard(3);
                        runTreeAnimation();
                    } else {
                        showCard(currentIdx);
                    }
                }});
                gsap.to("#p-fill", { width: `${((currentIdx + 1)/4)*100}%` });
            }
        }

        function initHearts() {
            const group = document.getElementById('heart-leaves');
            const colors = ['#ff4d6d', '#ff758f', '#c9184a'];
            // Positioning hearts around the reference branches
            const coords = [
                {x:50, y:110}, {x:40, y:100}, {x:60, y:95}, {x:150, y:70}, {x:160, y:60},
                {x:140, y:55}, {x:100, y:20}, {x:90, y:30}, {x:115, y:25}, {x:110, y:45}
            ];

            for(let i=0; i<50; i++) {
                const h = document.createElementNS("http://www.w3.org/2000/svg", "path");
                const base = coords[i % coords.length];
                const x = base.x + (Math.random() - 0.5) * 40;
                const y = base.y + (Math.random() - 0.5) * 40;
                
                h.setAttribute("d", "M0 0.5 C0 -0.5 -1 -1 -1.5 -0.5 C-2 0 -1 1.5 0 2 C1 1.5 2 0 1.5 -0.5 C1 -1 0 -0.5 0 0.5");
                h.setAttribute("fill", colors[Math.floor(Math.random()*3)]);
                h.setAttribute("transform", `translate(${x}, ${y}) scale(0)`);
                h.setAttribute("class", "heart-leaf");
                group.appendChild(h);
            }
        }

        function runTreeAnimation() {
            const tl = gsap.timeline();
            gsap.set("#nextBtn", { display: 'none' });

            // 1s: Tree & Swing Grows
            tl.fromTo("#tree-structure path, #tree-structure line, #tree-structure rect", 
                { strokeDasharray: 500, strokeDashoffset: 500, opacity: 0 }, 
                { strokeDashoffset: 0, opacity: 1, duration: 1.5, ease: "power2.inOut" }
            );
            
            // 2s: Hearts Bloom
            tl.to(".heart-leaf", { 
                scale: 3.5, 
                duration: 2, 
                stagger: { amount: 1.5, from: "random" }, 
                ease: "back.out(2)" 
            }, "-=0.5");
            
            // Final Move
            tl.to("#tree-box", { x: -140, scale: 0.8, duration: 1.5, ease: "expo.inOut" }, "+=0.3");
            tl.to("#final-messages", { opacity: 1, pointerEvents: 'auto' }, "-=1");
            tl.to(".msg-line", { opacity: 1, x: 0, stagger: 1, duration: 1.2 }, "-=0.5");
        }

        function makeWish(el) {
            el.innerHTML = "âœ¨";
            document.getElementById('wish-note').innerHTML = "May all your dreams come true!";
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        init3D();
    </script>
</body>
</html>
